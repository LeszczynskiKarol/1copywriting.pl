---
interface Props {
  title: string;
  description: string;
  href: string;
  category?: string;
  date?: Date;
  readingTime?: number;
  image?: string;
  imageAlt?: string;
  featured?: boolean;
}

const {
  title,
  description,
  href,
  category,
  date,
  readingTime,
  image,
  imageAlt,
  featured = false,
} = Astro.props;

const formattedDate = date
  ? new Intl.DateTimeFormat('pl-PL', {
      day: 'numeric',
      month: 'long',
      year: 'numeric',
    }).format(date)
  : null;
---

<article class:list={['card', { 'card--featured': featured }]}>
  <a href={href} class="card__link">
    {image && (
      <div class="card__image-wrap">
        <img src={image} alt={imageAlt || title} class="card__image" loading="lazy" decoding="async" />
      </div>
    )}
    <div class="card__body">
      {category && <span class="card__category">{category}</span>}
      <h3 class="card__title">{title}</h3>
      <p class="card__desc">{description}</p>
      {(formattedDate || readingTime) && (
        <div class="card__meta">
          {formattedDate && <time datetime={date?.toISOString()}>{formattedDate}</time>}
          {formattedDate && readingTime && <span class="card__meta-dot">·</span>}
          {readingTime && <span>{readingTime} min czytania</span>}
        </div>
      )}
    </div>
    <span class="card__arrow" aria-hidden="true">→</span>
  </a>
</article>

<style>
  .card {
    border-radius: var(--radius-lg);
    background: white;
    border: 1px solid var(--color-border-light);
    overflow: hidden;
    transition: all var(--transition-base);
  }

  .card:hover {
    border-color: var(--color-border);
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .card__link {
    display: flex;
    flex-direction: column;
    height: 100%;
    color: inherit;
    text-decoration: none;
    position: relative;
  }

  .card__image-wrap {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--color-paper-alt);
  }

  .card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }

  .card:hover .card__image {
    transform: scale(1.03);
  }

  .card__body {
    padding: var(--space-xl);
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .card__category {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-accent);
    margin-bottom: var(--space-sm);
  }

  .card__title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    line-height: var(--leading-snug);
    margin-bottom: var(--space-sm);
    transition: color var(--transition-fast);
  }

  .card:hover .card__title {
    color: var(--color-accent);
  }

  .card__desc {
    font-size: var(--text-sm);
    color: var(--color-ink-muted);
    line-height: var(--leading-normal);
    flex: 1;
    margin-bottom: var(--space-md);
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card__meta {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--text-xs);
    color: var(--color-ink-subtle);
  }

  .card__meta-dot {
    font-size: 0.6em;
  }

  .card__arrow {
    position: absolute;
    bottom: var(--space-xl);
    right: var(--space-xl);
    font-size: var(--text-lg);
    color: var(--color-ink-subtle);
    transition: all var(--transition-fast);
    opacity: 0;
    transform: translateX(-8px);
  }

  .card:hover .card__arrow {
    opacity: 1;
    transform: translateX(0);
    color: var(--color-accent);
  }

  /* Featured variant */
  .card--featured {
    grid-column: span 2;
  }

  .card--featured .card__link {
    flex-direction: row;
  }

  .card--featured .card__image-wrap {
    width: 45%;
    aspect-ratio: auto;
    flex-shrink: 0;
  }

  .card--featured .card__title {
    font-size: var(--text-2xl);
  }

  @media (max-width: 768px) {
    .card--featured {
      grid-column: span 1;
    }

    .card--featured .card__link {
      flex-direction: column;
    }

    .card--featured .card__image-wrap {
      width: 100%;
      aspect-ratio: 16/9;
    }
  }
</style>
