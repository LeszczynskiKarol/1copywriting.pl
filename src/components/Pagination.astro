---
/**
 * Pagination Component
 * 
 * Usage:
 *   <Pagination
 *     currentPage={page.currentPage}
 *     totalPages={page.lastPage}
 *     baseUrl="/blog"
 *   />
 */

interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

// Generate page numbers to show
function getPageNumbers(current: number, total: number): (number | 'ellipsis')[] {
  const pages: (number | 'ellipsis')[] = [];
  
  if (total <= 7) {
    // Show all pages if 7 or fewer
    for (let i = 1; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);
    
    if (current > 3) {
      pages.push('ellipsis');
    }
    
    // Pages around current
    const start = Math.max(2, current - 1);
    const end = Math.min(total - 1, current + 1);
    
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    
    if (current < total - 2) {
      pages.push('ellipsis');
    }
    
    // Always show last page
    pages.push(total);
  }
  
  return pages;
}

const pageNumbers = getPageNumbers(currentPage, totalPages);

// URL helpers
function getPageUrl(page: number): string {
  if (page === 1) {
    return `${baseUrl}/`;
  }
  return `${baseUrl}/${page}/`;
}

const prevUrl = currentPage > 1 ? getPageUrl(currentPage - 1) : null;
const nextUrl = currentPage < totalPages ? getPageUrl(currentPage + 1) : null;
---

{totalPages > 1 && (
  <nav class="pagination" aria-label="Paginacja">
    {/* Previous */}
    {prevUrl ? (
      <a href={prevUrl} class="pagination__btn pagination__btn--prev" aria-label="Poprzednia strona">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="pagination__btn-text">Poprzednia</span>
      </a>
    ) : (
      <span class="pagination__btn pagination__btn--prev pagination__btn--disabled" aria-disabled="true">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="pagination__btn-text">Poprzednia</span>
      </span>
    )}

    {/* Page numbers */}
    <div class="pagination__pages">
      {pageNumbers.map((page) => (
        page === 'ellipsis' ? (
          <span class="pagination__ellipsis">…</span>
        ) : page === currentPage ? (
          <span class="pagination__page pagination__page--current" aria-current="page">
            {page}
          </span>
        ) : (
          <a href={getPageUrl(page)} class="pagination__page">
            {page}
          </a>
        )
      ))}
    </div>

    {/* Next */}
    {nextUrl ? (
      <a href={nextUrl} class="pagination__btn pagination__btn--next" aria-label="Następna strona">
        <span class="pagination__btn-text">Następna</span>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    ) : (
      <span class="pagination__btn pagination__btn--next pagination__btn--disabled" aria-disabled="true">
        <span class="pagination__btn-text">Następna</span>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
    )}
  </nav>
)}

<style>
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    margin-top: var(--space-3xl);
    padding-top: var(--space-2xl);
    border-top: 1px solid var(--color-border-light);
  }

  /* Prev/Next buttons */
  .pagination__btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-ink-muted);
    background: white;
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .pagination__btn:hover:not(.pagination__btn--disabled) {
    color: var(--color-ink);
    border-color: var(--color-border);
    background: var(--color-paper-alt);
  }

  .pagination__btn--disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .pagination__btn-text {
    display: none;
  }

  /* Page numbers */
  .pagination__pages {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .pagination__page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-ink-muted);
    background: white;
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .pagination__page:hover:not(.pagination__page--current) {
    color: var(--color-ink);
    border-color: var(--color-border);
    background: var(--color-paper-alt);
  }

  .pagination__page--current {
    color: white;
    background: var(--color-accent);
    border-color: var(--color-accent);
  }

  .pagination__ellipsis {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    font-size: var(--text-sm);
    color: var(--color-ink-subtle);
  }

  /* Responsive */
  @media (min-width: 640px) {
    .pagination {
      gap: var(--space-md);
    }

    .pagination__btn {
      padding: var(--space-sm) var(--space-lg);
    }

    .pagination__btn-text {
      display: inline;
    }
  }

  @media (max-width: 480px) {
    .pagination__pages {
      gap: 4px;
    }

    .pagination__page,
    .pagination__ellipsis {
      min-width: 36px;
      height: 36px;
      font-size: var(--text-xs);
    }

    .pagination__btn {
      padding: var(--space-sm);
    }
  }
</style>