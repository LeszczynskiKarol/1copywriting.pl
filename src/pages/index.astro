---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import SiloCard from '@/components/SiloCard.astro';
import ArticleCard from '@/components/ArticleCard.astro';
import Newsletter from '@/components/Newsletter.astro';
import PromoSection from '@/components/PromoSection.astro';
import { SITE, SILOS, SCHEMA_ORG } from '@/utils/config';

// Get all posts to pick featured ones
const allPosts = await getCollection('blog');

// Featured slugs — pillar articles from the most important silos
const featuredSlugs = [
  'copywriting-co-to-jest',
  'rodzaje-copywritingu',
  'formuly-copywriterskie',
  'zasady-copywritingu',
];

const featuredArticles = featuredSlugs
  .map((slug) => allPosts.find((p) => p.slug === slug))
  .filter(Boolean);

// Count articles per silo for SiloCard
const siloCounts = SILOS.map((silo) => ({
  ...silo,
  count: allPosts.filter((p) => p.data.silo === silo.slug).length,
}));

const websiteSchema = {
  ...SCHEMA_ORG,
  potentialAction: {
    '@type': 'SearchAction',
    target: `${SITE.url}/szukaj?q={search_term_string}`,
    'query-input': 'required name=search_term_string',
  },
};
---

<BaseLayout
  title="Copywriting - przewodnik po pisaniu tekstów na zlecenie"
  description={SITE.description}
  schema={websiteSchema}
>
  <!-- HERO SECTION -->
  <section class="hero">
    <div class="hero__bg" aria-hidden="true">
      <div class="hero__grain"></div>
      <div class="hero__gradient"></div>
    </div>
    <div class="container hero__inner">
      <div class="hero__left animate-fade-in-up">
        <span class="hero__badge">Przewodnik po copywritingu</span>
        <h1 class="hero__title">
          Jedyny taki przewodnik
          <em class="hero__title-em">po copywritingu</em>
        </h1>
        <p class="hero__desc">
          Definicje, zasady, formuły i&nbsp;praktyczne poradniki.
          Wszystko o&nbsp;copywritingu — od&nbsp;podstaw po&nbsp;zaawansowane techniki
          — w&nbsp;jednym, kompletnym źródle.
        </p>
        <div class="hero__actions">
          <a href="/blog/copywriting-co-to-jest/" class="btn btn--primary">
            Zacznij od podstaw
          </a>
          <a href="/blog/formuly-copywriterskie/" class="btn btn--outline">
            Poznaj formuły
          </a>
        </div>
      </div>

      <div class="hero__right animate-fade-in-up" style="animation-delay: 0.15s">
        <div class="hero__visual">
          <div class="hero__visual-card hero__visual-card--1">
            <span class="hero__visual-formula">AIDA</span>
            <span class="hero__visual-sub">Attention → Interest → Desire → Action</span>
          </div>
          <div class="hero__visual-card hero__visual-card--2">
            <span class="hero__visual-formula">PAS</span>
            <span class="hero__visual-sub">Problem → Agitate → Solution</span>
          </div>
          <div class="hero__visual-card hero__visual-card--3">
            <span class="hero__visual-formula">BAB</span>
            <span class="hero__visual-sub">Before → After → Bridge</span>
          </div>
        </div>
      </div>

      <div class="hero__stats animate-fade-in-up" style="animation-delay: 0.25s">
        <div class="hero__stat">
          <span class="hero__stat-num">{allPosts.length}+</span>
          <span class="hero__stat-label">artykułów</span>
        </div>
        <div class="hero__stat-divider"></div>
        <div class="hero__stat">
          <span class="hero__stat-num">{SILOS.length}</span>
          <span class="hero__stat-label">kategorii</span>
        </div>
        <div class="hero__stat-divider"></div>
        <div class="hero__stat">
          <span class="hero__stat-num">15+</span>
          <span class="hero__stat-label">formuł</span>
        </div>
      </div>
    </div>
  </section>

  <!-- SILOS / CATEGORIES -->
  <section class="section section--silos">
    <div class="container">
      <div class="section__header">
        <h2 class="section__title">Baza wiedzy</h2>
        <p class="section__desc">
          {SILOS.length} kategorii — od&nbsp;definicji po&nbsp;zaawansowane techniki perswazji.
        </p>
      </div>
      <div class="silos-grid stagger">
        {siloCounts.map((silo) => (
          <SiloCard
            title={silo.title}
            description={silo.description}
            href={`/${silo.slug}/`}
            icon={silo.icon}
            color={silo.color}
            count={silo.count}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- FEATURED ARTICLES -->
  <section class="section section--articles">
    <div class="container">
      <div class="section__header">
        <h2 class="section__title">Zacznij tutaj</h2>
        <p class="section__desc">Najważniejsze artykuły, od których warto zacząć przygodę z copywritingiem.</p>
      </div>
      <div class="articles-grid stagger">
        {featuredArticles.map((post, i) => post && (
          <ArticleCard
            title={post.data.title}
            description={post.data.description}
            href={`/blog/${post.slug}/`}
            category={post.data.category}
            date={post.data.publishDate}
            readingTime={post.data.readingTime}
            image={post.data.image}
            imageAlt={post.data.imageAlt}
            featured={i === 0}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- FORMULAS HIGHLIGHT -->
  <section class="section section--formulas">
    <div class="container">
      <div class="formulas__inner">
        <div class="formulas__content">
          <span class="formulas__badge">Formuły</span>
          <h2 class="formulas__title">15+ sprawdzonych formuł copywriterskich</h2>
          <p class="formulas__desc">
            AIDA, PAS, BAB, 4P, FAB — poznaj schematy pisania, które od&nbsp;dekad generują
            milionowe zyski. Każda formuła z&nbsp;wyjaśnieniem i&nbsp;przykładami.
          </p>
          <a href="/blog/formuly-copywriterskie/" class="btn btn--primary">
            Poznaj formuły →
          </a>
        </div>
        <div class="formulas__cards">
          <div class="formula-card">
            <span class="formula-card__name">AIDA</span>
            <span class="formula-card__desc">Attention → Interest → Desire → Action</span>
          </div>
          <div class="formula-card">
            <span class="formula-card__name">PAS</span>
            <span class="formula-card__desc">Problem → Agitate → Solution</span>
          </div>
          <div class="formula-card">
            <span class="formula-card__name">BAB</span>
            <span class="formula-card__desc">Before → After → Bridge</span>
          </div>
          <div class="formula-card">
            <span class="formula-card__name">4P</span>
            <span class="formula-card__desc">Promise → Picture → Proof → Push</span>
          </div>
          <div class="formula-card">
            <span class="formula-card__name">FAB</span>
            <span class="formula-card__desc">Features → Advantages → Benefits</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SMART-COPY.AI PROMO -->
  <PromoSection />

  <!-- NEWSLETTER -->
  <section class="section">
    <div class="container">
      <Newsletter variant="banner" />
    </div>
  </section>
</BaseLayout>

<style>
  /* ===== HERO — two column ===== */
  .hero {
    position: relative;
    padding: var(--space-5xl) 0 var(--space-3xl);
    overflow: hidden;
  }

  .hero__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .hero__gradient {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(192, 62, 46, 0.06) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(212, 168, 67, 0.04) 0%, transparent 50%);
  }

  .hero__grain {
    position: absolute;
    inset: 0;
    opacity: 0.3;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    background-size: 128px;
    mix-blend-mode: overlay;
  }

  .hero__inner {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: var(--space-2xl) var(--space-3xl);
    align-items: center;
  }

  .hero__left {
    grid-column: 1;
    grid-row: 1;
  }

  .hero__right {
    grid-column: 2;
    grid-row: 1;
  }

  .hero__stats {
    grid-column: 1 / -1;
    grid-row: 2;
  }

  .hero__badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--color-accent);
    background: var(--color-accent-light);
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-full);
    margin-bottom: var(--space-xl);
  }

  .hero__title {
    font-size: var(--text-6xl);
    font-family: var(--font-display);
    line-height: 1.05;
    letter-spacing: -0.03em;
    max-width: 14ch;
    margin-bottom: var(--space-xl);
  }

  .hero__title-em {
    font-style: italic;
    color: var(--color-accent);
  }

  .hero__desc {
    font-size: var(--text-lg);
    color: var(--color-ink-muted);
    line-height: var(--leading-relaxed);
    max-width: 48ch;
    margin-bottom: var(--space-2xl);
  }

  .hero__actions {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  /* Visual cards on right */
  .hero__visual {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    max-width: 380px;
    margin-left: auto;
  }

  .hero__visual-card {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding: var(--space-lg) var(--space-xl);
    background: white;
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-base);
  }

  .hero__visual-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .hero__visual-card--1 {
    transform: translateX(0);
  }

  .hero__visual-card--2 {
    transform: translateX(16px);
  }

  .hero__visual-card--3 {
    transform: translateX(32px);
  }

  .hero__visual-card--1:hover { transform: translateX(0) translateY(-2px); }
  .hero__visual-card--2:hover { transform: translateX(16px) translateY(-2px); }
  .hero__visual-card--3:hover { transform: translateX(32px) translateY(-2px); }

  .hero__visual-formula {
    font-family: var(--font-mono);
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--color-accent);
    min-width: 52px;
  }

  .hero__visual-sub {
    font-size: var(--text-sm);
    color: var(--color-ink-muted);
  }

  /* Stats — improved with dividers */
  .hero__stats {
    display: flex;
    align-items: center;
    gap: var(--space-2xl);
    padding-top: var(--space-2xl);
    border-top: 1px solid var(--color-border);
  }

  .hero__stat {
    display: flex;
    align-items: baseline;
    gap: var(--space-sm);
  }

  .hero__stat-num {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    color: var(--color-ink);
    letter-spacing: -0.02em;
  }

  .hero__stat-label {
    font-size: var(--text-sm);
    color: var(--color-ink-subtle);
  }

  .hero__stat-divider {
    width: 1px;
    height: 32px;
    background: var(--color-border);
  }

  /* ===== BUTTONS ===== */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-xl);
    font-family: var(--font-body);
    font-size: var(--text-sm);
    font-weight: 600;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
    border: 1px solid transparent;
    white-space: nowrap;
  }

  .btn--primary {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .btn--primary:hover {
    background: var(--color-accent-hover);
    border-color: var(--color-accent-hover);
    color: white;
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }

  .btn--outline {
    background: transparent;
    color: var(--color-ink);
    border-color: var(--color-border);
  }

  .btn--outline:hover {
    background: var(--color-paper-alt);
    border-color: var(--color-ink-subtle);
    color: var(--color-ink);
    transform: translateY(-1px);
  }

  /* ===== SECTIONS ===== */
  .section {
    padding: var(--space-4xl) 0;
  }

  .section__header {
    margin-bottom: var(--space-2xl);
  }

  .section__title {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    margin-bottom: var(--space-sm);
  }

  .section__desc {
    font-size: var(--text-base);
    color: var(--color-ink-muted);
    max-width: 50ch;
    margin-bottom: 0;
  }

  .silos-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-md);
  }

  .articles-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
  }

  .section--articles {
    background: var(--color-paper-warm);
    border-top: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
  }

  /* Formulas section */
  .section--formulas {
    background: var(--color-ink);
    color: white;
  }

  .formulas__inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4xl);
    align-items: center;
  }

  .formulas__badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--color-accent-2);
    margin-bottom: var(--space-lg);
  }

  .formulas__title {
    color: white;
    font-size: var(--text-3xl);
    margin-bottom: var(--space-lg);
  }

  .formulas__desc {
    color: #9ca3af;
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-xl);
  }

  .formulas__cards {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .formula-card {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding: var(--space-lg) var(--space-xl);
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }

  .formula-card:hover {
    background: rgba(255, 255, 255, 0.07);
    border-color: rgba(255, 255, 255, 0.15);
  }

  .formula-card__name {
    font-family: var(--font-mono);
    font-weight: 500;
    font-size: var(--text-lg);
    color: var(--color-accent-2);
    min-width: 56px;
  }

  .formula-card__desc {
    font-size: var(--text-sm);
    color: #9ca3af;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 1024px) {
    .hero__inner {
      grid-template-columns: 1fr;
    }

    .hero__right {
      grid-column: 1;
      grid-row: 2;
    }

    .hero__stats {
      grid-row: 3;
    }

    .hero__visual {
      max-width: 100%;
      margin-left: 0;
    }

    .hero__visual-card--2 { transform: translateX(0); }
    .hero__visual-card--3 { transform: translateX(0); }
    .hero__visual-card--2:hover { transform: translateY(-2px); }
    .hero__visual-card--3:hover { transform: translateY(-2px); }

    .silos-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .formulas__inner {
      grid-template-columns: 1fr;
      gap: var(--space-2xl);
    }
  }

  @media (max-width: 768px) {
    .hero {
      padding: var(--space-3xl) 0 var(--space-2xl);
    }

    .silos-grid {
      grid-template-columns: 1fr;
    }

    .articles-grid {
      grid-template-columns: 1fr;
    }

    .hero__stats {
      gap: var(--space-xl);
    }

    .hero__stat-divider {
      height: 24px;
    }
  }

  @media (max-width: 480px) {
    .hero__actions {
      flex-direction: column;
    }

    .btn {
      justify-content: center;
    }

    .hero__stats {
      flex-wrap: wrap;
    }
  }
</style>