---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Breadcrumbs from '@/components/Breadcrumbs.astro';
import ArticleCard from '@/components/ArticleCard.astro';
import Newsletter from '@/components/Newsletter.astro';
import PromoSection from '@/components/PromoSection.astro';
import Pagination from '@/components/Pagination.astro';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
  );

  // pageSize must be a literal or defined inside this function
  return paginate(posts, { pageSize: 12 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const breadcrumbs = [
  { label: 'Strona g≈Ç√≥wna', href: '/' },
  { label: 'Blog' },
];

// SEO: different title for page 2+
const pageTitle = page.currentPage === 1 
  ? 'Blog o copywritingu' 
  : `Blog o copywritingu ‚Äî strona ${page.currentPage}`;

const pageDescription = page.currentPage === 1
  ? 'Artyku≈Çy, poradniki i przewodniki o copywritingu. Techniki pisania, formu≈Çy, narzƒôdzia i inspiracje dla copywriter√≥w.'
  : `Artyku≈Çy o copywritingu ‚Äî strona ${page.currentPage} z ${page.lastPage}. Poradniki, techniki i inspiracje dla copywriter√≥w.`;
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
>
  <section class="blog-page">
    <div class="container">
      <Breadcrumbs items={breadcrumbs} />

      <header class="blog-page__header">
        <h1 class="blog-page__title">Blog</h1>
        <p class="blog-page__desc">
          Artyku≈Çy, poradniki i&nbsp;przewodniki. Wszystko, czego potrzebujesz, ≈ºeby pisaƒá lepiej.
        </p>
        {page.lastPage > 1 && (
          <p class="blog-page__count">
            Strona {page.currentPage} z {page.lastPage} ¬∑ {page.total} artyku≈Ç√≥w
          </p>
        )}
      </header>

      {page.data.length > 0 ? (
        <>
          <div class="blog-page__grid">
            {page.data.map((post, i) => (
              <ArticleCard
                title={post.data.title}
                description={post.data.description}
                href={`/blog/${post.slug}/`}
                category={post.data.category}
                date={post.data.publishDate}
                readingTime={post.data.readingTime}
                image={post.data.image}
                imageAlt={post.data.imageAlt}
                featured={page.currentPage === 1 && i === 0}
              />
            ))}
          </div>

          <Pagination
            currentPage={page.currentPage}
            totalPages={page.lastPage}
            baseUrl="/blog"
          />
        </>
      ) : (
        <div class="blog-page__empty">
          <div class="blog-page__empty-icon">üìù</div>
          <h2>Pierwsze artyku≈Çy ju≈º wkr√≥tce</h2>
          <p>Zapisz siƒô na newsletter ‚Äî damy Ci znaƒá, gdy opublikujemy nowe tre≈õci.</p>
        </div>
      )}
    </div>
  </section>

  <!-- SMART-COPY.AI PROMO (only on first page) -->
  {page.currentPage === 1 && <PromoSection variant="compact" />}

  <section class="blog-page__footer">
    <div class="container">
      <Newsletter variant="inline" />
    </div>
  </section>
</BaseLayout>

<style>
  .blog-page {
    padding: var(--space-2xl) 0 var(--space-4xl);
  }

  .blog-page__header {
    margin-bottom: var(--space-3xl);
  }

  .blog-page__title {
    font-size: var(--text-4xl);
    margin-bottom: var(--space-md);
  }

  .blog-page__desc {
    font-size: var(--text-lg);
    color: var(--color-ink-muted);
    max-width: 50ch;
  }

  .blog-page__count {
    font-size: var(--text-sm);
    color: var(--color-ink-subtle);
    margin-top: var(--space-md);
  }

  .blog-page__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
  }

  .blog-page__empty {
    text-align: center;
    padding: var(--space-4xl) var(--space-xl);
    background: var(--color-paper-warm);
    border: 1px dashed var(--color-border);
    border-radius: var(--radius-xl);
  }

  .blog-page__empty-icon {
    font-size: 3rem;
    margin-bottom: var(--space-lg);
  }

  .blog-page__empty h2 {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-md);
  }

  .blog-page__empty p {
    color: var(--color-ink-muted);
    max-width: 40ch;
    margin-inline: auto;
  }

  .blog-page__footer {
    padding: var(--space-4xl) 0;
  }

  .blog-page__footer .container {
    max-width: var(--max-content);
  }

  @media (max-width: 768px) {
    .blog-page__grid {
      grid-template-columns: 1fr;
    }
  }
</style>