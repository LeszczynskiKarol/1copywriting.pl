---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Breadcrumbs from '@/components/Breadcrumbs.astro';
import ArticleCard from '@/components/ArticleCard.astro';
import Newsletter from '@/components/Newsletter.astro';
import { SILOS, SITE } from '@/utils/config';

export function getStaticPaths() {
  return SILOS.map((silo) => ({
    params: { silo: silo.slug },
    props: { silo },
  }));
}

const { silo } = Astro.props;

const breadcrumbs = [
  { label: 'Strona główna', href: '/' },
  { label: silo.title },
];

const categorySchema = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: silo.title,
  description: silo.description,
  url: `${SITE.url}/${silo.slug}/`,
  isPartOf: {
    '@type': 'WebSite',
    name: SITE.title,
    url: SITE.url,
  },
};

// Placeholder articles - replace with content collection queries
const articles: any[] = [];
---

<BaseLayout
  title={`${silo.title} — Przewodnik`}
  description={silo.description}
  schema={categorySchema}
>
  <section class="silo-page">
    <div class="container">
      <Breadcrumbs items={breadcrumbs} />

      <header class="silo-page__header">
        <div class="silo-page__icon" style={`--silo-color: ${silo.color}`}>
          {silo.icon}
        </div>
        <h1 class="silo-page__title">{silo.title}</h1>
        <p class="silo-page__desc">{silo.description}</p>
      </header>

      {articles.length > 0 ? (
        <div class="silo-page__grid">
          {articles.map((article: any) => (
            <ArticleCard
              title={article.title}
              description={article.description}
              href={article.href}
              category={silo.title}
              date={article.date}
              readingTime={article.readingTime}
            />
          ))}
        </div>
      ) : (
        <div class="silo-page__empty">
          <div class="silo-page__empty-icon" aria-hidden="true">✍️</div>
          <h2 class="silo-page__empty-title">Treści w przygotowaniu</h2>
          <p class="silo-page__empty-desc">
            Pracujemy nad artykułami w&nbsp;tej kategorii.
            Zapisz się na newsletter, żeby nie przegapić publikacji.
          </p>
        </div>
      )}

      <div class="silo-page__newsletter">
        <Newsletter variant="inline" />
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .silo-page {
    padding: var(--space-2xl) 0 var(--space-4xl);
  }

  .silo-page__header {
    margin-bottom: var(--space-3xl);
    max-width: var(--max-content);
  }

  .silo-page__icon {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    background: color-mix(in srgb, var(--silo-color) 10%, transparent);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-xl);
  }

  .silo-page__title {
    font-size: var(--text-4xl);
    margin-bottom: var(--space-md);
  }

  .silo-page__desc {
    font-size: var(--text-lg);
    color: var(--color-ink-muted);
    line-height: var(--leading-relaxed);
    max-width: 55ch;
  }

  .silo-page__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
  }

  .silo-page__empty {
    text-align: center;
    padding: var(--space-4xl) var(--space-xl);
    background: var(--color-paper-warm);
    border: 1px dashed var(--color-border);
    border-radius: var(--radius-xl);
  }

  .silo-page__empty-icon {
    font-size: 3rem;
    margin-bottom: var(--space-lg);
  }

  .silo-page__empty-title {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-md);
  }

  .silo-page__empty-desc {
    color: var(--color-ink-muted);
    max-width: 40ch;
    margin-inline: auto;
  }

  .silo-page__newsletter {
    margin-top: var(--space-4xl);
    max-width: var(--max-content);
  }

  @media (max-width: 768px) {
    .silo-page__grid {
      grid-template-columns: 1fr;
    }
  }
</style>
